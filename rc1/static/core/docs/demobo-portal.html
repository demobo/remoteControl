<!DOCTYPE html>

<html>
<head>
  <title>demobo-portal.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>demobo-portal.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Generated by CoffeeScript 1.6.2
demobo-portal.js 0.9.1</p>
<p>(c) 2013 Jiahao Li, de Mobo LLC</p>
<p><code>window.demoboLoading</code> is a flag that keeps loading bookmarklet safe</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>() {
  <span class="keyword">var</span> Bobo, DemoboPortal, Dispatcher, base, breaker, cacheJS, connectScript, demoboHandlers, extend, loadJS, nativeForEach, remotes, version, _,
    __indexOf = [].indexOf || <span class="keyword">function</span>(item) { <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.length; i &lt; l; i++) { <span class="keyword">if</span> (i <span class="keyword">in</span> <span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>[i] === item) <span class="keyword">return</span> i; } <span class="keyword">return</span> -<span class="number">1</span>; };

  <span class="keyword">if</span> (!window.demoboLoading) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Set the flag so that another demobo script wont interrupt</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    window.demoboLoading = <span class="number">1</span>;
    <span class="keyword">if</span> (window.demoboOn) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>If demobo is already on, do nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">delete</span> window.demoboLoading;
    } <span class="keyword">else</span> {
      window.demoboOn = <span class="number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>Baseline Setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Current version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      version = <span class="string">'0.9.1'</span>;
      base = window.demoboBase + <span class="string">'/apps/'</span>;
      connectScript = window.demoboBase + <span class="string">'/core/connect.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>This sets the routing of controllers for websites (currently hardcoded)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      remotes = {
        <span class="string">'www.pandora.com'</span>: <span class="string">'pandora.com-new.js'</span>,
        <span class="string">'douban.fm'</span>: <span class="string">'douban.fm-new.js'</span>,
        <span class="string">'www.youtube.com'</span>: <span class="string">'youtube.com-new.js'</span>,
        <span class="string">'www.last.fm'</span>: <span class="string">'last.fm-new.js'</span>,
        <span class="string">'8tracks.com'</span>: <span class="string">'8tracks.com-new.js'</span>,
        <span class="string">'vimeo.com'</span>: <span class="string">'vimeo.com-new.js'</span>,
        <span class="string">'youku.com'</span>: <span class="string">'youku.com-new.js'</span>,
        <span class="string">'www.rdio.com'</span>: <span class="string">'rdio.com-new.js'</span>,
        <span class="string">'grooveshark.com'</span>: <span class="string">'grooveshark.com-new.js'</span>,
        <span class="string">'play.spotify.com'</span>: <span class="string">'spotify.com-new.js'</span>,
        <span class="string">'sfbay.craigslist.org'</span>: <span class="string">'yelp.com.js'</span>,
        <span class="string">'www.yellowpages.com'</span>: <span class="string">'yelp.com.js'</span>,
        <span class="string">'www.foodspotting.com'</span>: <span class="string">'yelp.com.js'</span>,
        <span class="string">'www.urbanspoon.com'</span>: <span class="string">'yelp.com.js'</span>,
        <span class="string">'foursquare.com'</span>: <span class="string">'yelp.com.js'</span>
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2>definitions of utilities </h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>A function that caches a script using object tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cacheJS = <span class="keyword">function</span>(src) {
        <span class="keyword">var</span> cache;

        cache = document.createElement(<span class="string">'object'</span>);
        cache.data = src;
        cache.className = <span class="string">'demoboCache'</span>;
        cache.width = <span class="number">0</span>;
        cache.height = <span class="number">0</span>;
        <span class="keyword">return</span> document.body.appendChild(cache);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Try to preload demobo API and other scripts as early as possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cacheJS(<span class="string">'//d32q09dnclw46p.cloudfront.net/demobo.1.7.0.min.js'</span>);
      cacheJS(connectScript);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>A function that loads a script and executes the call back after the script is executed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      loadJS = <span class="keyword">function</span>(src, f) {
        <span class="keyword">var</span> script;

        script = document.createElement(<span class="string">'script'</span>);
        script.setAttribute(<span class="string">'type'</span>, <span class="string">'text/javascript'</span>);
        script.setAttribute(<span class="string">'src'</span>, src);
        script.className = <span class="string">'demoboJS'</span>;
        document.body.appendChild(script);
        <span class="keyword">return</span> script.onload = f;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2>external libraries </h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Constants used by underscore.js codes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _ = {};
      nativeForEach = Array.prototype.forEach;
      breaker = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Functions defined by underscore.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      
    _.each = <span class="keyword">function</span>(obj, iterator, context) {
      <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span>;
      <span class="keyword">if</span> (nativeForEach &amp;&amp; obj.forEach === nativeForEach) {
        obj.forEach(iterator, context);
      } <span class="keyword">else</span> <span class="keyword">if</span> (obj.length === +obj.length) {
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = obj.length; i &lt; l; i++) {
          <span class="keyword">if</span> (iterator.call(context, obj[i], i, obj) === breaker) <span class="keyword">return</span>;
        }
      } <span class="keyword">else</span> {
        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
          <span class="keyword">if</span> (_.has(obj, key)) {
            <span class="keyword">if</span> (iterator.call(context, obj[key], key, obj) === breaker) <span class="keyword">return</span>;
          }
        }
      }
    };
      _.has = <span class="keyword">function</span>(obj, key) {
        <span class="keyword">return</span> Object.prototype.hasOwnProperty.call(obj, key);
      };
      
    _.extend = <span class="keyword">function</span>(obj) {
      _.each(Array.prototype.slice.call(arguments, <span class="number">1</span>), <span class="keyword">function</span>(source) {
        <span class="keyword">if</span> (source) {
          <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> source) {
            obj[prop] = source[prop];
          }
        }
      });
      <span class="keyword">return</span> obj;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Codes copied and adapted from backbone.js. Used for inheritance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      extend = <span class="keyword">function</span>(protoProps, staticProps) {
        <span class="keyword">var</span> child, parent;

        parent = <span class="keyword">this</span>;
        <span class="keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="string">'constructor'</span>)) {
          child = protoProps.constructor;
        } <span class="keyword">else</span> {
          child = <span class="keyword">function</span>() {
            <span class="keyword">return</span> parent.apply(<span class="keyword">this</span>, arguments);
          };
        }
        _.extend(child, parent, staticProps);
        <span class="function"><span class="keyword">function</span> <span class="title">ctor</span><span class="params">()</span> {</span> <span class="keyword">this</span>.constructor = child; } 
      ctor.prototype = parent.prototype; 
      child.prototype = <span class="keyword">new</span> ctor(); 
      child.__super__ = parent.prototype;
        <span class="keyword">return</span> child;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2>Bobo base class</h2>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Base class of all BOBOs. Every new bobo should extend this class and overwrite at least its <code>initialize</code> method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Bobo = (<span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Constructor of <code>Bobo</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="function"><span class="keyword">function</span> <span class="title">Bobo</span><span class="params">(portal)</span> {</span>
          <span class="keyword">var</span> defaultConfig;

          <span class="keyword">this</span>.portal = portal;
          <span class="keyword">this</span>.boboInfos = {};
          <span class="keyword">this</span>._events = {};
          defaultConfig = {
            <span class="string">'developer'</span>: <span class="string">'developer@demobo.com'</span>
          };
          <span class="keyword">this</span>.boboInfos[<span class="string">'priority'</span>] = <span class="number">1</span>;
          <span class="keyword">this</span>.boboInfos[<span class="string">'config'</span>] = defaultConfig;
          <span class="keyword">this</span>.boboInfos[<span class="string">'boboID'</span>] = <span class="literal">null</span>;
          <span class="keyword">this</span>.boboInfos[<span class="string">'connectedDevices'</span>] = {};
          <span class="keyword">this</span>.boboInfos[<span class="string">'inputEventHandlers'</span>] = {};
          <span class="keyword">this</span>.initialize();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Register a event handler to the Object&#39;s properties. In the handler, <code>this</code> refers to this object. Example:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.on = <span class="keyword">function</span>(eventName, handler) {
          <span class="keyword">this</span>._events[eventName] = handler;
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Trigger specific event handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.trigger = <span class="keyword">function</span>(eventName) {
          <span class="keyword">var</span> handler;

          <span class="keyword">if</span> ((handler = <span class="keyword">this</span>._events[eventName])) {
            handler.apply(<span class="keyword">this</span>, [].slice.apply(arguments, [<span class="number">1</span>]));
            <span class="keyword">return</span> <span class="literal">true</span>;
          } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Call the function on device. if <code>devicedID</code> is not specified, call the function on all devices connected to this bobo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.callFunction = <span class="keyword">function</span>(functionName, data, deviceID) {
          <span class="keyword">return</span> <span class="keyword">this</span>.portal.callFunction(functionName, data, deviceID, <span class="keyword">this</span>.getInfo(<span class="string">'boboID'</span>));
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Called immediately upon this bobo&#39;s instantiation (guaranteed). A bobo that inherits the base <code>Bobo</code> class should overwrite this method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.initialize = <span class="keyword">function</span>() {
          <span class="keyword">this</span>.setInfo(<span class="string">'controller'</span>, {});
          <span class="keyword">this</span>.setInfo(<span class="string">'inputEventHandlers'</span>, {});
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Return the value of the key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.getInfo = <span class="keyword">function</span>(key) {
          <span class="keyword">return</span> <span class="keyword">this</span>.boboInfos[key];
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>set the value of the key. If the old value is different from the new value, &#39;change:<code>key</code>&#39; event is triggered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.setInfo = <span class="keyword">function</span>(key, val) {
          <span class="keyword">var</span> oldVal;

          oldVal = <span class="keyword">this</span>.boboInfos[key];
          <span class="keyword">if</span> (oldVal !== val) {
            <span class="keyword">this</span>.boboInfos[key] = val;
            <span class="keyword">this</span>.trigger(<span class="string">'change:'</span> + key, oldVal, val);
          }
          <span class="keyword">return</span> oldVal;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>set controller params. which will be passed to phone when new device is connected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.setController = <span class="keyword">function</span>(params) {
          <span class="keyword">return</span> <span class="keyword">this</span>.setInfo(<span class="string">'controller'</span>, params);
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>set event listeners. which will be in turn set to demobo when the bobo is instantiated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.setInputEventHandlers = <span class="keyword">function</span>(inputEventHandlers) {
          <span class="keyword">var</span> eventName, handlerName, hs, wrapper, _thisBobo;

          _thisBobo = <span class="keyword">this</span>;
          wrapper = <span class="keyword">function</span>(bobo, functionName) {
            <span class="keyword">return</span> <span class="keyword">function</span>() {
              <span class="keyword">return</span> bobo[functionName].apply(bobo, arguments);
            };
          };
          hs = {};
          <span class="keyword">for</span> (eventName <span class="keyword">in</span> inputEventHandlers) {
            handlerName = inputEventHandlers[eventName];
            hs[eventName] = wrapper(_thisBobo, handlerName);
          }
          <span class="keyword">this</span>.setInfo(<span class="string">'inputEventHandlers'</span>, hs);
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>reservered for future use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.run = <span class="keyword">function</span>() {};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>reservered for future use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.resume = <span class="keyword">function</span>() {};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>reservered for future use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Bobo.prototype.finish = <span class="keyword">function</span>() {};

        <span class="keyword">return</span> Bobo;

      })();</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Set up <code>Bobo</code> for global use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Bobo.extend = extend;
      window.Bobo = Bobo;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>a dispatcher object for event listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Dispatcher = (<span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Constructor of <code>Dispatcher</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="function"><span class="keyword">function</span> <span class="title">Dispatcher</span><span class="params">(eventListened, portal)</span> {</span>
          <span class="keyword">this</span>.eventListened = eventListened;
          <span class="keyword">this</span>.portal = portal;
          <span class="keyword">this</span>.handlers = {};
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>add a bobo&#39;s event handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Dispatcher.prototype.addHandler = <span class="keyword">function</span>(boboID, handler) {
          <span class="keyword">return</span> <span class="keyword">this</span>.handlers[boboID] = handler;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>call corresponding handler based on <code>deviceID</code> (and its corresponding <code>boboID</code>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Dispatcher.prototype.dispatch = <span class="keyword">function</span>(value, data) {
          <span class="keyword">var</span> boboID, deviceID;

          deviceID = data.deviceID;
          boboID = <span class="keyword">this</span>.portal.getDeviceBoboID(deviceID);
          <span class="keyword">if</span> (__indexOf.call(Object.keys(<span class="keyword">this</span>.handlers), boboID) &gt;= <span class="number">0</span>) {
            <span class="keyword">return</span> <span class="keyword">this</span>.handlers[boboID](value, data);
          }
          <span class="keyword">return</span> <span class="literal">null</span>;
        };

        <span class="keyword">return</span> Dispatcher;

      })();</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Handlers used by a <code>DemoboPortal</code> object, which listen to the change of the object&#39;s properties, e.g. change of bobos, addition of new bobo, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      demoboHandlers = {
        handlerBobosChange: <span class="keyword">function</span>(oldVal, newVal) {
          <span class="keyword">return</span> console.log(<span class="string">'bobos changed from '</span> + oldVal + <span class="string">' to '</span> + newVal);
        },
        handlerCurBoboChange: <span class="keyword">function</span>(oldVal, newVal) {
          <span class="keyword">return</span> console.log(<span class="string">'current bobo changed from '</span> + oldVal + <span class="string">' to '</span> + newVal);
        },
        handleBoboAdd: <span class="keyword">function</span>(boboID, boboObj) {
          <span class="keyword">return</span> console.log(<span class="string">'new bobo added, id: '</span> + boboID);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Handler that runs when a new device is connected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        connectedHandler: <span class="keyword">function</span>(portal) {
          <span class="keyword">return</span> <span class="keyword">function</span>(data) {
            console.log(<span class="string">'connected'</span>);
            portal.setDeviceController(portal.get(<span class="string">'curBobo'</span>), data.deviceID);
            <span class="keyword">return</span> portal.addDevice(data.deviceID);
          };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Handler that runs when a new device is disconnected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mbHandler: <span class="keyword">function</span>(portal) {
          <span class="keyword">return</span> <span class="keyword">function</span>(data) {
            console.log(<span class="string">'mbcommand'</span>);
            <span class="keyword">switch</span> (data.value.command) {
              <span class="keyword">case</span> <span class="string">'switchBobo'</span>:
                <span class="keyword">return</span> portal.switchBobo(data.value.boboID);
              <span class="keyword">default</span>:
                <span class="keyword">return</span> <span class="literal">false</span>;
            }
          };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Handler that runs when a new device is disconnected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        disconnectedHandler: <span class="keyword">function</span>(portal) {
          <span class="keyword">return</span> <span class="keyword">function</span>(data) {
            console.log(<span class="string">'disconnected'</span>);
            <span class="keyword">return</span> portal.removeDevice(data.deviceID);
          };
        }
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Class definition of DemoboPortal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      DemoboPortal = (<span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>constructor of <code>DemoboPortal</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="function"><span class="keyword">function</span> <span class="title">DemoboPortal</span><span class="params">()</span> {</span>
          <span class="keyword">this</span>.attributes = {};
          <span class="keyword">this</span>.DEMOBO = window.DEMOBO;
          <span class="keyword">this</span>.demobo = window.demobo;
          <span class="keyword">this</span>.DEMOBO_DEBUG = window.DEMOBO_DEBUG;
          <span class="keyword">this</span>._events = {};
          <span class="keyword">this</span>.initialize();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Get current website&#39;s remote control url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.getRemote = <span class="keyword">function</span>() {
          <span class="keyword">var</span> domain, key, val;

          domain = document.domain;
          <span class="keyword">for</span> (key <span class="keyword">in</span> remotes) {
            val = remotes[key];
            <span class="keyword">if</span> (key === domain) {
              <span class="keyword">return</span> val;
            }
          }
          <span class="keyword">return</span> <span class="literal">null</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Return an object that contains all available bobos for the current website.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.getBoboRoutes = <span class="keyword">function</span>() {
          <span class="keyword">var</span> remote, toReturn;

          toReturn = {
            <span class="string">'input'</span>: base + <span class="string">'inputtool-new.js'</span>,
            <span class="string">'dummy'</span>: base + <span class="string">'dummy.js'</span>
          };
          remote = <span class="keyword">this</span>.getRemote();
          <span class="keyword">if</span> (remote) {
            toReturn[<span class="string">'remote'</span>] = base + remote;
          }
          <span class="keyword">return</span> toReturn;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Called immediately upon the object&#39;s instantiation (guaranteed)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.initialize = <span class="keyword">function</span>() {
          <span class="keyword">var</span> boboRoutes, name, route;

          boboRoutes = <span class="keyword">this</span>.getBoboRoutes();
          <span class="keyword">this</span>.set(<span class="string">'version'</span>, version);
          <span class="keyword">this</span>.set(<span class="string">'bobos'</span>, {});
          <span class="keyword">this</span>.set(<span class="string">'eventHandlers'</span>, {});
          <span class="keyword">this</span>.set(<span class="string">'deviceBoboMap'</span>, {});
          <span class="keyword">this</span>.set(<span class="string">'boboDeviceMap'</span>, {});
          <span class="keyword">this</span>.set(<span class="string">'curBobo'</span>, <span class="literal">null</span>);
          <span class="keyword">this</span>.set(<span class="string">'boboRoutes'</span>, boboRoutes);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Register event handlers for connected, disconnected,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.demobo.addEventListener(<span class="string">'connected'</span>, demoboHandlers.connectedHandler(<span class="keyword">this</span>));
          <span class="keyword">this</span>.demobo.addEventListener(<span class="string">'disconnected'</span>, demoboHandlers.disconnectedHandler(<span class="keyword">this</span>));
          <span class="keyword">this</span>.demobo.addEventListener(<span class="string">'mb'</span>, demoboHandlers.mbHandler(<span class="keyword">this</span>));
          <span class="keyword">this</span>.on(<span class="string">'change:bobos'</span>, demoboHandlers.handlerBobosChange);
          <span class="keyword">this</span>.on(<span class="string">'change:curBobo'</span>, demoboHandlers.handlerCurBoboChange);
          <span class="keyword">this</span>.on(<span class="string">'add:bobos'</span>, demoboHandlers.handleBoboAdd);
          window.DEMOBO.init = <span class="keyword">function</span>() {};
          window.demobo.start();
          window.addEventListener(<span class="string">'focus'</span>, <span class="keyword">function</span>() {
            <span class="keyword">return</span> setTimeout(<span class="keyword">function</span>() {
              <span class="keyword">return</span> window.demobo.getDeviceInfo.apply(window.demobo, [<span class="string">''</span>, <span class="string">'g=function f(data){window.demoboPortal.addExistentDevice.apply(window.demoboPortal, [data])}'</span>]);
            }, <span class="number">1000</span>);
          });
          <span class="keyword">for</span> (name <span class="keyword">in</span> boboRoutes) {
            route = boboRoutes[name];
            loadJS(route);
          }
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Add a connected device and map it to the current bobo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.addExistentDevice = <span class="keyword">function</span>(data) {
          <span class="keyword">var</span> deviceID;

          deviceID = data.deviceID;
          <span class="keyword">if</span> (__indexOf.call(Object.keys(<span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>)), deviceID) &lt; <span class="number">0</span>) {
            <span class="keyword">this</span>.setDeviceController(<span class="keyword">this</span>.get(<span class="string">'curBobo'</span>), deviceID);
            <span class="keyword">return</span> <span class="keyword">this</span>.addDevice(deviceID);
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Make an rpc on the device. if <code>deviceID</code> is not specified, make the rpc on all devices connected to the specified bobo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.callFunction = <span class="keyword">function</span>(functionName, data, deviceID, boboID) {
          <span class="keyword">var</span> dID, deviceIDs, _i, _len;

          <span class="keyword">if</span> (deviceID) {
            <span class="keyword">return</span> <span class="keyword">this</span>.demobo.callFunction(functionName, data, deviceID);
          } <span class="keyword">else</span> {
            deviceIDs = <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[boboID];
            <span class="keyword">for</span> (_i = <span class="number">0</span>, _len = deviceIDs.length; _i &lt; _len; _i++) {
              dID = deviceIDs[_i];
              <span class="keyword">this</span>.demobo.callFunction(functionName, data, dID);
            }
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>If the event is already registered, add a handler to its dispatcher; otherwise create a new dispatcher</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.addEventListener = <span class="keyword">function</span>(eventName, handler, boboID) {
          <span class="keyword">var</span> dispatcher, handlers, _temp;

          handlers = <span class="keyword">this</span>.get(<span class="string">'eventHandlers'</span>);
          dispatcher = handlers[eventName];
          <span class="keyword">if</span> (dispatcher != <span class="literal">null</span>) {
            handlers[eventName].addHandler(boboID, handler);
          } <span class="keyword">else</span> {
            dispatcher = <span class="keyword">new</span> Dispatcher(eventName, <span class="keyword">this</span>);
            handlers[eventName] = dispatcher;
            dispatcher.addHandler(boboID, handler);
            _temp = {};
            _temp[eventName] = <span class="keyword">function</span>() {
              <span class="keyword">return</span> dispatcher.dispatch.apply(dispatcher, arguments);
            };
            <span class="keyword">this</span>.demobo.mapInputEvents(_temp);
          }
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Get the boboID of the device, based on the current mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.getDeviceBoboID = <span class="keyword">function</span>(deviceID) {
          <span class="keyword">var</span> map;

          map = <span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>);
          <span class="keyword">return</span> map[deviceID];
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Set a device&#39;s controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.setDeviceController = <span class="keyword">function</span>(boboObj, deviceID) {
          <span class="keyword">var</span> bobo, boboID, boboInfos, curBoboID, info, toSend, _ref;

          toSend = {};
          _.extend(toSend, boboObj.getInfo(<span class="string">'controller'</span>));
          boboInfos = [];
          curBoboID = <span class="keyword">this</span>.get(<span class="string">'curBobo'</span>).getInfo(<span class="string">'boboID'</span>);
          _ref = <span class="keyword">this</span>.get(<span class="string">'bobos'</span>);
          <span class="keyword">for</span> (boboID <span class="keyword">in</span> _ref) {
            bobo = _ref[boboID];
            info = {};
            info[<span class="string">'id'</span>] = boboID;
            info[<span class="string">'icon'</span>] = bobo.getInfo(<span class="string">'iconClass'</span>);
            <span class="keyword">if</span> (boboID === curBoboID) {
              info[<span class="string">'active'</span>] = <span class="number">1</span>;
            }
            boboInfos.push(info);
          }
          toSend[<span class="string">'bobos'</span>] = boboInfos;
          <span class="keyword">return</span> <span class="keyword">this</span>.demobo.setController(toSend, deviceID);
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Return true if <code>deviceID</code> is already in the mapping; false otherwise.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.hasDevice = <span class="keyword">function</span>(deviceID) {
          <span class="keyword">return</span> __indexOf.call(<span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>), deviceID) &gt;= <span class="number">0</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Add a device</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.addDevice = <span class="keyword">function</span>(deviceID, boboID) {
          <span class="keyword">if</span> (!<span class="keyword">this</span>.hasDevice(deviceID)) {
            <span class="keyword">if</span> (!boboID) {

              boboID = <span class="keyword">this</span>.get(<span class="string">'curBobo'</span>).getInfo(<span class="string">'boboID'</span>);
            }
            <span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>)[deviceID] = boboID;
            <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[boboID].push(deviceID);
            <span class="keyword">this</span>.trigger(<span class="string">'add:device'</span>, deviceID);
            <span class="keyword">return</span> <span class="literal">true</span>;
          }
          <span class="keyword">return</span> <span class="literal">false</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Delete <code>deviceID</code> from the mapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.removeDevice = <span class="keyword">function</span>(deviceID) {
          <span class="keyword">var</span> boboID, devices;

          boboID = <span class="keyword">this</span>.getDeviceBoboID(deviceID);
          devices = <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[boboID];
          devices.splice(devices.indexOf(deviceID), <span class="number">1</span>);
          <span class="keyword">delete</span> <span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>)[deviceID];
          <span class="keyword">this</span>.trigger(<span class="string">'delete:device'</span>, deviceID);
          <span class="keyword">return</span> <span class="literal">true</span>;
        };



        DemoboPortal.prototype.setDevice = <span class="keyword">function</span>(deviceID, boboID) {
          <span class="keyword">var</span> devices, oldBoboId;

          <span class="keyword">if</span> (<span class="keyword">this</span>.hasDevice(deviceID)) {
            oldBoboId = <span class="keyword">this</span>.getDeviceBoboID(deviceID);
            <span class="keyword">if</span> (oldBoboId === boboID) {
              <span class="keyword">return</span> <span class="literal">false</span>;
            } <span class="keyword">else</span> {
              <span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>)[deviceID] = boboID;
              devices = <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[oldBoboID];
              devices.splice(devices.indexOf(deviceID), <span class="number">1</span>);
              <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[boboID].push(deviceID);
              <span class="keyword">this</span>.trigger(<span class="string">'change:device'</span>, deviceID, oldBoboID, boboID);
              <span class="keyword">return</span> <span class="literal">true</span>;
            }
          } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="keyword">this</span>.addDevice(deviceID);
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>TODO: might be remvoed?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.setController = <span class="keyword">function</span>(controller) {
          <span class="keyword">return</span> <span class="keyword">this</span>.demobo.setController(controller);
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Switch to another bobo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.switchBobo = <span class="keyword">function</span>(boboID) {
          <span class="keyword">var</span> boboDeviceMap, deviceBoboMap, deviceID, devices, newBobo, oldBoboID, _i, _j, _len, _len1;

          oldBoboID = <span class="keyword">this</span>.get(<span class="string">'curBobo'</span>).getInfo(<span class="string">'boboID'</span>);
          boboDeviceMap = <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>);
          deviceBoboMap = <span class="keyword">this</span>.get(<span class="string">'deviceBoboMap'</span>);
          devices = boboDeviceMap[oldBoboID];
          <span class="keyword">for</span> (_i = <span class="number">0</span>, _len = devices.length; _i &lt; _len; _i++) {
            deviceID = devices[_i];
            deviceBoboMap[deviceID] = boboID;
          }
          boboDeviceMap[boboID] = devices.slice();
          boboDeviceMap[oldBoboID] = [];
          newBobo = <span class="keyword">this</span>.get(<span class="string">'bobos'</span>)[boboID];
          <span class="keyword">this</span>.set(<span class="string">'curBobo'</span>, newBobo);
          <span class="keyword">for</span> (_j = <span class="number">0</span>, _len1 = devices.length; _j &lt; _len1; _j++) {
            deviceID = devices[_j];
            <span class="keyword">this</span>.setDeviceController(newBobo, deviceID);
          }
          newBobo.resume();
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Take an argument of a extended <code>Bobo</code> class and create a new <code>Bobo</code> instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.addBobo = <span class="keyword">function</span>(boboClass) {
          <span class="keyword">var</span> boboID, boboObj, bobos, eventName, handler, handlers, temp;

          boboObj = <span class="keyword">new</span> boboClass(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If <code>boboID</code> dosn&#39;t exist, set <code>boboID</code> to this bobo&#39;s controller url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          temp = boboObj.getInfo(<span class="string">'boboID'</span>);
          <span class="keyword">if</span> (temp) {
            boboID = temp;
          } <span class="keyword">else</span> {
            boboID = boboObj.getInfo(<span class="string">'controller'</span>).url;
            boboObj.setInfo(<span class="string">'boboID'</span>, boboID);
          }
          bobos = <span class="keyword">this</span>.get(<span class="string">'bobos'</span>);
          <span class="keyword">if</span> (__indexOf.call(bobos, boboID) &lt; <span class="number">0</span>) {
            bobos[boboID] = boboObj;
            <span class="keyword">this</span>.get(<span class="string">'boboDeviceMap'</span>)[boboID] = [];
            handlers = boboObj.getInfo(<span class="string">'inputEventHandlers'</span>);
            <span class="keyword">for</span> (eventName <span class="keyword">in</span> handlers) {
              handler = handlers[eventName];
              <span class="keyword">this</span>.addEventListener(eventName, handler, boboID);
            }
            <span class="keyword">if</span> (!<span class="keyword">this</span>.get(<span class="string">'curBobo'</span>)) {
              <span class="keyword">this</span>.set(<span class="string">'curBobo'</span>, boboObj);

              setTimeout(<span class="keyword">function</span>() {
                <span class="keyword">return</span> window.demobo.getDeviceInfo.apply(window.demobo, [<span class="string">''</span>, <span class="string">'g=function f(data){window.demoboPortal.addExistentDevice.apply(window.demoboPortal, [data])}'</span>]);
              }, <span class="number">1000</span>);
            } <span class="keyword">else</span> <span class="keyword">if</span> (boboObj.getInfo(<span class="string">'priority'</span>) &gt; <span class="keyword">this</span>.get(<span class="string">'curBobo'</span>).getInfo(<span class="string">'priority'</span>)) {
              <span class="keyword">this</span>.switchBobo(boboObj.getInfo(<span class="string">'boboID'</span>));
            }
            <span class="keyword">this</span>.trigger(<span class="string">'add:bobos'</span>, boboID, boboObj);
            <span class="keyword">return</span> <span class="literal">true</span>;
          }
          <span class="keyword">return</span> <span class="literal">false</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Return the value of the key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.get = <span class="keyword">function</span>(key) {
          <span class="keyword">return</span> <span class="keyword">this</span>.attributes[key];
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Register a event with its handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.on = <span class="keyword">function</span>(eventName, handler) {
          <span class="keyword">this</span>._events[eventName] = handler;
          <span class="keyword">return</span> <span class="literal">true</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Trigger event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.trigger = <span class="keyword">function</span>(eventName) {
          <span class="keyword">var</span> handler;

          <span class="keyword">if</span> ((handler = <span class="keyword">this</span>._events[eventName])) {
            handler.apply(<span class="keyword">this</span>, [].slice.apply(arguments, [<span class="number">1</span>]));
            <span class="keyword">return</span> <span class="literal">true</span>;
          } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="literal">false</span>;
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Set an attribute&#39;s value. If the old value is different from the new value, &#39;change:<code>key</code>&#39; is triggered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.set = <span class="keyword">function</span>(key, val) {
          <span class="keyword">var</span> oldVal;

          oldVal = <span class="keyword">this</span>.attributes[key];
          <span class="keyword">if</span> (!(oldVal === val)) {
            <span class="keyword">this</span>.attributes[key] = val;
            <span class="keyword">this</span>.trigger(<span class="string">'change:'</span> + key, oldVal, val);
          }
          <span class="keyword">return</span> oldVal;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Create the view of a bobo, which would be showed up in portal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        DemoboPortal.prototype.createBoboView = <span class="keyword">function</span>(boboID, boboInfo) {
          <span class="keyword">return</span> <span class="literal">null</span>;
        };

        <span class="keyword">return</span> DemoboPortal;

      })();</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h2>Execution</h2>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>instantiate a <code>DemoboPortal</code> object and expose to global use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      loadJS(<span class="string">'http://localhost:1240/core/demobo.1.7.0.js'</span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> demoboPortal;

        demoboPortal = <span class="keyword">new</span> DemoboPortal();
        window.demoboPortal = demoboPortal;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Load script of connection dialog and show the dialog if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> loadJS(connectScript, <span class="keyword">function</span>() {
          <span class="keyword">return</span> window.__dmtg = <span class="keyword">function</span>() {
            <span class="keyword">var</span> visible;

            visible = document.getElementById(<span class="string">'demoboConnect'</span>).style.top !== <span class="string">''</span>;
            <span class="keyword">if</span> (visible) {
              <span class="keyword">return</span> window._hideDemoboConnect();
            } <span class="keyword">else</span> {
              <span class="keyword">return</span> window._showDemoboConnect();
            }
          };
        });
      });
    }
    <span class="keyword">delete</span> window.demoboLoading;
  }

}).call(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
